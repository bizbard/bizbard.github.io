<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta name="author" content="Jeff"><meta http-equiv="X-UA-Compatible" content="chrome=1"><meta name="revisit-after" content="7 days"><meta name="viewport" content="width=device-width,initial-scale=1"><link rel="icon" href="/favicon.svg" type="image/svg+xml"><link rel="alternate" type="application/rss+xml" title="Jeff's Blog" href="/feed.xml"><meta name="msapplication-TileColor" content="#ffffff"><title>Modern Javascript - 2021</title><script>!function(){var e=window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches,t=localStorage.getItem("vueuse-color-scheme")||"auto";("dark"===t||e&&"light"!==t)&&document.documentElement.classList.toggle("dark",!0)}()</script><script type="module" crossorigin="" src="/assets/app-e02a7697.js"></script><style>*,:after,:before{box-sizing:border-box;border-width:0;border-style:solid;border-color:#e5e7eb}html{line-height:1.5;-webkit-text-size-adjust:100%;-moz-tab-size:4;tab-size:4;font-family:ui-sans-serif,system-ui,-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica Neue,Arial,Noto Sans,sans-serif,"Apple Color Emoji","Segoe UI Emoji",Segoe UI Symbol,"Noto Color Emoji"}body{margin:0;line-height:inherit}h1,h2,h3{font-size:inherit;font-weight:inherit}a{color:inherit;text-decoration:inherit}strong{font-weight:bolder}code,pre{font-family:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,Liberation Mono,Courier New,monospace;font-size:1em}figure,h1,h2,h3,p,pre{margin:0}ul{list-style:none;margin:0;padding:0}img,svg{display:block;vertical-align:middle}img{max-width:100%;height:auto}:root{--c-bg:#fff;--c-scrollbar:#eee;--c-scrollbar-hover:#bbb}html{background-color:var(--c-bg)}html{overflow:scroll}*{scrollbar-color:var(--c-scrollbar) var(--c-bg)}.prose{color:var(--fg);max-width:65ch;font-size:1rem;line-height:1.75}.prose a{color:var(--fg-deeper);text-decoration:none;font-weight:500}.prose strong{color:var(--fg-deep);font-weight:600}.prose ul>li{position:relative;padding-left:1.75em}.prose ul>li:before{content:"";position:absolute;background-color:#d1d5db;border-radius:50%;width:.375em;height:.375em;top:.6875em;left:.25em}.prose h1{color:var(--fg-deeper);font-weight:800;font-size:2.25em;margin-top:0;margin-bottom:.8888889em;line-height:1.1111111}.prose h2{color:var(--fg-deep);font-weight:700;font-size:1.5em;margin-top:2em;margin-bottom:1em;line-height:1.3333333}.prose h3{color:inherit;font-weight:600;font-size:1.25em;margin-top:1.6em;margin-bottom:.6em;line-height:1.6;opacity:.7}.prose figure figcaption{color:#6b7280;font-size:.875em;line-height:1.4285714;margin-top:.8571429em}.prose code{color:var(--fg-deep);font-weight:600;font-size:.875em}.prose code:before{content:"`"}.prose code:after{content:"`"}.prose pre{color:#e5e7eb;overflow-x:auto;font-size:.875em;line-height:1.7142857;margin-top:1.7142857em;margin-bottom:1.7142857em;border-radius:.375rem;padding:.8571429em 1.1428571em}.prose pre code{background-color:transparent;border-width:0;border-radius:0;padding:0;font-weight:400;color:inherit;font-size:inherit;font-family:inherit;line-height:inherit}.prose pre code:before{content:none}.prose pre code:after{content:none}.prose p{margin-top:1.25em;margin-bottom:1.25em}.prose img{margin-top:2em;margin-bottom:2em}.prose figure{margin-top:2em;margin-bottom:2em}.prose figure>*{margin-top:0;margin-bottom:0}.prose ul{margin-top:1.25em;margin-bottom:1.25em;list-style-type:none}.prose li{margin-top:.5em;margin-bottom:.5em}.prose ul ul{margin-top:.75em;margin-bottom:.75em}.prose>:first-child{margin-top:0}.prose>:last-child{margin-bottom:0}.prose em{color:inherit}.prose pre:not(.shiki){padding:0;margin:0;background:0 0}.prose .shiki{font-family:DM Mono,Input Mono,Fira Code,monospace;font-size:1.05em;line-height:1.4;margin:.5em 0}.prose img{width:100%}.shiki-light{background:#f8f8f8!important}.shiki-dark{background:#0e0e0e!important}html:not(.dark) .shiki-dark{display:none}.prose{--fg:#555;--fg-deep:#222;--fg-deeper:#000;color:var(--fg)}.prose a{font-weight:inherit;text-decoration:none;border-bottom:1px solid rgba(125,125,125,.3);transition:border .3s ease-in-out}.prose a:hover{border-bottom:1px solid var(--fg)}a.header-anchor{float:left;margin-top:.125em;margin-left:-1.2em;padding-right:.5em;font-size:.85em;opacity:0;text-decoration:none;border:0!important}a.header-anchor:focus,a.header-anchor:hover{text-decoration:none}h2:focus .header-anchor,h2:hover .header-anchor,h3:focus .header-anchor,h3:hover .header-anchor{opacity:.5}@media (max-width:1200px){.table-of-contents{display:none}}.table-of-contents{position:fixed;top:80px;padding-top:70px;font-size:.8em;right:10px;width:200px;bottom:0;overflow-y:auto;overflow-x:hidden;text-overflow:ellipsis;opacity:0;transition:all .4s ease-out}.table-of-contents:hover{opacity:.5}.table-of-contents ul>li:before{display:none}.table-of-contents ul>li{padding-left:.8rem}*,:after,:before{--un-rotate:0;--un-rotate-x:0;--un-rotate-y:0;--un-rotate-z:0;--un-scale-x:1;--un-scale-y:1;--un-scale-z:1;--un-skew-x:0;--un-skew-y:0;--un-translate-x:0;--un-translate-y:0;--un-translate-z:0;--un-scroll-snap-strictness:proximity;--un-border-spacing-x:0;--un-border-spacing-y:0;--un-ring-offset-shadow:0 0 rgba(0,0,0,0);--un-ring-shadow:0 0 rgba(0,0,0,0);--un-shadow:0 0 rgba(0,0,0,0);--un-ring-offset-width:0px;--un-ring-offset-color:#fff;--un-ring-width:0px;--un-ring-color:rgba(147,197,253,.5)}@font-face{font-family:DM Mono;font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/dmmono/v10/aFTU7PB1QTsUX8KYthSQBLyM.woff2) format("woff2");unicode-range:U+0100-024F,U+0259,U+1E00-1EFF,U+2020,U+20A0-20AB,U+20AD-20CF,U+2113,U+2C60-2C7F,U+A720-A7FF}@font-face{font-family:DM Mono;font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/dmmono/v10/aFTU7PB1QTsUX8KYthqQBA.woff2) format("woff2");unicode-range:U+0000-00FF,U+0131,U+0152-0153,U+02BB-02BC,U+02C6,U+02DA,U+02DC,U+2000-206F,U+2074,U+20AC,U+2122,U+2191,U+2193,U+2212,U+2215,U+FEFF,U+FFFD}@font-face{font-family:Inter;font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v12/UcCO3FwrK3iLTeHuS_fvQtMwCp50KnMw2boKoduKmMEVuLyfAZJhiI2B.woff2) format("woff2");unicode-range:U+0460-052F,U+1C80-1C88,U+20B4,U+2DE0-2DFF,U+A640-A69F,U+FE2E-FE2F}@font-face{font-family:Inter;font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v12/UcCO3FwrK3iLTeHuS_fvQtMwCp50KnMw2boKoduKmMEVuLyfAZthiI2B.woff2) format("woff2");unicode-range:U+0301,U+0400-045F,U+0490-0491,U+04B0-04B1,U+2116}@font-face{font-family:Inter;font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v12/UcCO3FwrK3iLTeHuS_fvQtMwCp50KnMw2boKoduKmMEVuLyfAZNhiI2B.woff2) format("woff2");unicode-range:U+1F00-1FFF}@font-face{font-family:Inter;font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v12/UcCO3FwrK3iLTeHuS_fvQtMwCp50KnMw2boKoduKmMEVuLyfAZxhiI2B.woff2) format("woff2");unicode-range:U+0370-03FF}@font-face{font-family:Inter;font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v12/UcCO3FwrK3iLTeHuS_fvQtMwCp50KnMw2boKoduKmMEVuLyfAZBhiI2B.woff2) format("woff2");unicode-range:U+0102-0103,U+0110-0111,U+0128-0129,U+0168-0169,U+01A0-01A1,U+01AF-01B0,U+1EA0-1EF9,U+20AB}@font-face{font-family:Inter;font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v12/UcCO3FwrK3iLTeHuS_fvQtMwCp50KnMw2boKoduKmMEVuLyfAZFhiI2B.woff2) format("woff2");unicode-range:U+0100-024F,U+0259,U+1E00-1EFF,U+2020,U+20A0-20AB,U+20AD-20CF,U+2113,U+2C60-2C7F,U+A720-A7FF}@font-face{font-family:Inter;font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v12/UcCO3FwrK3iLTeHuS_fvQtMwCp50KnMw2boKoduKmMEVuLyfAZ9hiA.woff2) format("woff2");unicode-range:U+0000-00FF,U+0131,U+0152-0153,U+02BB-02BC,U+02C6,U+02DA,U+02DC,U+2000-206F,U+2074,U+20AC,U+2122,U+2191,U+2193,U+2212,U+2215,U+FEFF,U+FFFD}@font-face{font-family:Inter;font-style:normal;font-weight:600;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v12/UcCO3FwrK3iLTeHuS_fvQtMwCp50KnMw2boKoduKmMEVuGKYAZJhiI2B.woff2) format("woff2");unicode-range:U+0460-052F,U+1C80-1C88,U+20B4,U+2DE0-2DFF,U+A640-A69F,U+FE2E-FE2F}@font-face{font-family:Inter;font-style:normal;font-weight:600;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v12/UcCO3FwrK3iLTeHuS_fvQtMwCp50KnMw2boKoduKmMEVuGKYAZthiI2B.woff2) format("woff2");unicode-range:U+0301,U+0400-045F,U+0490-0491,U+04B0-04B1,U+2116}@font-face{font-family:Inter;font-style:normal;font-weight:600;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v12/UcCO3FwrK3iLTeHuS_fvQtMwCp50KnMw2boKoduKmMEVuGKYAZNhiI2B.woff2) format("woff2");unicode-range:U+1F00-1FFF}@font-face{font-family:Inter;font-style:normal;font-weight:600;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v12/UcCO3FwrK3iLTeHuS_fvQtMwCp50KnMw2boKoduKmMEVuGKYAZxhiI2B.woff2) format("woff2");unicode-range:U+0370-03FF}@font-face{font-family:Inter;font-style:normal;font-weight:600;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v12/UcCO3FwrK3iLTeHuS_fvQtMwCp50KnMw2boKoduKmMEVuGKYAZBhiI2B.woff2) format("woff2");unicode-range:U+0102-0103,U+0110-0111,U+0128-0129,U+0168-0169,U+01A0-01A1,U+01AF-01B0,U+1EA0-1EF9,U+20AB}@font-face{font-family:Inter;font-style:normal;font-weight:600;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v12/UcCO3FwrK3iLTeHuS_fvQtMwCp50KnMw2boKoduKmMEVuGKYAZFhiI2B.woff2) format("woff2");unicode-range:U+0100-024F,U+0259,U+1E00-1EFF,U+2020,U+20A0-20AB,U+20AD-20CF,U+2113,U+2C60-2C7F,U+A720-A7FF}@font-face{font-family:Inter;font-style:normal;font-weight:600;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v12/UcCO3FwrK3iLTeHuS_fvQtMwCp50KnMw2boKoduKmMEVuGKYAZ9hiA.woff2) format("woff2");unicode-range:U+0000-00FF,U+0131,U+0152-0153,U+02BB-02BC,U+02C6,U+02DA,U+02DC,U+2000-206F,U+2074,U+20AC,U+2122,U+2191,U+2193,U+2212,U+2215,U+FEFF,U+FFFD}@font-face{font-family:Inter;font-style:normal;font-weight:800;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v12/UcCO3FwrK3iLTeHuS_fvQtMwCp50KnMw2boKoduKmMEVuDyYAZJhiI2B.woff2) format("woff2");unicode-range:U+0460-052F,U+1C80-1C88,U+20B4,U+2DE0-2DFF,U+A640-A69F,U+FE2E-FE2F}@font-face{font-family:Inter;font-style:normal;font-weight:800;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v12/UcCO3FwrK3iLTeHuS_fvQtMwCp50KnMw2boKoduKmMEVuDyYAZthiI2B.woff2) format("woff2");unicode-range:U+0301,U+0400-045F,U+0490-0491,U+04B0-04B1,U+2116}@font-face{font-family:Inter;font-style:normal;font-weight:800;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v12/UcCO3FwrK3iLTeHuS_fvQtMwCp50KnMw2boKoduKmMEVuDyYAZNhiI2B.woff2) format("woff2");unicode-range:U+1F00-1FFF}@font-face{font-family:Inter;font-style:normal;font-weight:800;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v12/UcCO3FwrK3iLTeHuS_fvQtMwCp50KnMw2boKoduKmMEVuDyYAZxhiI2B.woff2) format("woff2");unicode-range:U+0370-03FF}@font-face{font-family:Inter;font-style:normal;font-weight:800;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v12/UcCO3FwrK3iLTeHuS_fvQtMwCp50KnMw2boKoduKmMEVuDyYAZBhiI2B.woff2) format("woff2");unicode-range:U+0102-0103,U+0110-0111,U+0128-0129,U+0168-0169,U+01A0-01A1,U+01AF-01B0,U+1EA0-1EF9,U+20AB}@font-face{font-family:Inter;font-style:normal;font-weight:800;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v12/UcCO3FwrK3iLTeHuS_fvQtMwCp50KnMw2boKoduKmMEVuDyYAZFhiI2B.woff2) format("woff2");unicode-range:U+0100-024F,U+0259,U+1E00-1EFF,U+2020,U+20A0-20AB,U+20AD-20CF,U+2113,U+2C60-2C7F,U+A720-A7FF}@font-face{font-family:Inter;font-style:normal;font-weight:800;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v12/UcCO3FwrK3iLTeHuS_fvQtMwCp50KnMw2boKoduKmMEVuDyYAZ9hiA.woff2) format("woff2");unicode-range:U+0000-00FF,U+0131,U+0152-0153,U+02BB-02BC,U+02C6,U+02DA,U+02DC,U+2000-206F,U+2074,U+20AC,U+2122,U+2191,U+2193,U+2212,U+2215,U+FEFF,U+FFFD}[i-ri-article-line=""]{--un-icon:url("data:image/svg+xml;utf8,%3Csvg viewBox='0 0 24 24' display='inline-block' height='1.2em' width='1.2em' vertical-align='text-bottom' xmlns='http://www.w3.org/2000/svg' %3E%3Cpath fill='currentColor' d='M20 22H4a1 1 0 0 1-1-1V3a1 1 0 0 1 1-1h16a1 1 0 0 1 1 1v18a1 1 0 0 1-1 1zm-1-2V4H5v16h14zM7 6h4v4H7V6zm0 6h10v2H7v-2zm0 4h10v2H7v-2zm6-9h4v2h-4V7z'/%3E%3C/svg%3E");-webkit-mask:var(--un-icon) no-repeat;mask:var(--un-icon) no-repeat;-webkit-mask-size:100% 100%;mask-size:100% 100%;background-color:currentColor;color:inherit;display:inline-block;height:1.2em;width:1.2em;vertical-align:text-bottom}[i-uil-github-alt=""]{--un-icon:url("data:image/svg+xml;utf8,%3Csvg viewBox='0 0 24 24' display='inline-block' height='1.2em' width='1.2em' vertical-align='text-bottom' xmlns='http://www.w3.org/2000/svg' %3E%3Cpath fill='currentColor' d='M10.07 20.503a1 1 0 0 0-1.18-.983c-1.31.24-2.963.276-3.402-.958a5.708 5.708 0 0 0-1.837-2.415a1.2 1.2 0 0 1-.167-.11a1 1 0 0 0-.93-.645h-.005a1 1 0 0 0-1 .995c-.004.815.81 1.338 1.141 1.514a4.44 4.44 0 0 1 .924 1.36c.365 1.023 1.423 2.576 4.466 2.376l.003.098l.004.268a1 1 0 0 0 2 0l-.005-.318c-.005-.19-.012-.464-.012-1.182ZM20.737 5.377a5.39 5.39 0 0 0 .09-.42a6.278 6.278 0 0 0-.408-3.293a1.002 1.002 0 0 0-.615-.58c-.356-.12-1.67-.357-4.184 1.25a13.87 13.87 0 0 0-6.354 0C6.762.75 5.455.966 5.102 1.079a.997.997 0 0 0-.631.584a6.3 6.3 0 0 0-.404 3.357c.025.127.051.246.079.354a6.27 6.27 0 0 0-1.256 3.83a8.422 8.422 0 0 0 .043.921c.334 4.603 3.334 5.984 5.424 6.459a4.591 4.591 0 0 0-.118.4a1 1 0 0 0 1.942.479a1.678 1.678 0 0 1 .468-.878a1 1 0 0 0-.546-1.745c-3.454-.395-4.954-1.802-5.18-4.899a6.61 6.61 0 0 1-.033-.738a4.258 4.258 0 0 1 .92-2.713a3.022 3.022 0 0 1 .195-.231a1 1 0 0 0 .188-1.025a3.388 3.388 0 0 1-.155-.555a4.094 4.094 0 0 1 .079-1.616a7.543 7.543 0 0 1 2.415 1.18a1.009 1.009 0 0 0 .827.133a11.777 11.777 0 0 1 6.173.001a1.005 1.005 0 0 0 .83-.138a7.572 7.572 0 0 1 2.406-1.19a4.04 4.04 0 0 1 .087 1.578a3.205 3.205 0 0 1-.169.607a1 1 0 0 0 .188 1.025c.078.087.155.18.224.268A4.122 4.122 0 0 1 20 9.203a7.039 7.039 0 0 1-.038.777c-.22 3.056-1.725 4.464-5.195 4.86a1 1 0 0 0-.546 1.746a1.63 1.63 0 0 1 .466.908a3.06 3.06 0 0 1 .093.82v2.333c-.01.648-.01 1.133-.01 1.356a1 1 0 1 0 2 0c0-.217 0-.692.01-1.34v-2.35a4.881 4.881 0 0 0-.155-1.311a4.256 4.256 0 0 0-.116-.416a6.513 6.513 0 0 0 5.445-6.424A8.697 8.697 0 0 0 22 9.203a6.13 6.13 0 0 0-1.263-3.826Z'/%3E%3C/svg%3E");-webkit-mask:var(--un-icon) no-repeat;mask:var(--un-icon) no-repeat;-webkit-mask-size:100% 100%;mask-size:100% 100%;background-color:currentColor;color:inherit;display:inline-block;height:1.2em;width:1.2em;vertical-align:text-bottom}.absolute{position:absolute}.z-40{z-index:40}.m-6{margin:1.5rem}.m-auto{margin:auto}.\!-mt-2{margin-top:-.5rem!important}.mb-0{margin-bottom:0}.mb-6{margin-bottom:1.5rem}.mb-8{margin-bottom:2rem}.mt-10{margin-top:2.5rem}.mt-8{margin-top:2rem}.h-10{height:2.5rem}.w-10{width:2.5rem}.flex{display:flex}.flex-auto{flex:1 1 auto}.select-none{user-select:none}.px-7{padding-left:1.75rem;padding-right:1.75rem}.py-10{padding-top:2.5rem;padding-bottom:2.5rem}.font-mono,[font-mono=""]{font-family:DM Mono,ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,Liberation Mono,Courier New,monospace}.font-sans{font-family:Inter,ui-sans-serif,system-ui,-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica Neue,Arial,Noto Sans,sans-serif,"Apple Color Emoji","Segoe UI Emoji",Segoe UI Symbol,"Noto Color Emoji"}.text-sm{font-size:.875rem;line-height:1.25rem}.text-gray-700{--un-text-opacity:1;color:rgba(55,65,81,var(--un-text-opacity))}.hover\:op75:hover{opacity:.75}.op50,.opacity-50,[op50=""]{opacity:.5}.outline-none{outline:2px solid transparent;outline-offset:2px}@media (max-width:767.9px){.lt-md\:hidden{display:none}}@media (min-width:768px){[md\:hidden=""]{display:none}}@media (min-width:1024px){.lg\:fixed{position:fixed}}.nav[data-v-116d6082]{padding:2rem;width:100%;display:grid;grid-template-columns:auto max-content;box-sizing:border-box}.nav>[data-v-116d6082]{margin:auto}.nav a[data-v-116d6082]{cursor:pointer;text-decoration:none;color:inherit;transition:opacity .2s ease;opacity:.6;outline:0}.nav a[data-v-116d6082]:hover{opacity:1;text-decoration-color:inherit}.nav .right[data-v-116d6082]{display:grid;grid-gap:1.2rem;grid-auto-flow:column}.nav .right>[data-v-116d6082]{margin:auto}</style><link rel="preload" href="/assets/index-85ed439e.css" as="style"><link rel="modulepreload" crossorigin="" href="/assets/learn-javascript-2021-e300aab4.js"><meta property="og:title" content="Modern Javascript - 2021"><meta property="og:description" content="Modern Javascript - 2021"><meta name="description" content="Modern Javascript - 2021"><link rel="preload" as="font" crossorigin="anonymous" href="https://fonts.gstatic.com/s/dmmono/v10/aFTU7PB1QTsUX8KYthSQBLyM.woff2"><link rel="preload" as="font" crossorigin="anonymous" href="https://fonts.gstatic.com/s/dmmono/v10/aFTU7PB1QTsUX8KYthqQBA.woff2"><link rel="preload" as="font" crossorigin="anonymous" href="https://fonts.gstatic.com/s/inter/v12/UcCO3FwrK3iLTeHuS_fvQtMwCp50KnMw2boKoduKmMEVuLyfAZJhiI2B.woff2"><link rel="preload" as="font" crossorigin="anonymous" href="https://fonts.gstatic.com/s/inter/v12/UcCO3FwrK3iLTeHuS_fvQtMwCp50KnMw2boKoduKmMEVuLyfAZthiI2B.woff2"><link rel="preload" as="font" crossorigin="anonymous" href="https://fonts.gstatic.com/s/inter/v12/UcCO3FwrK3iLTeHuS_fvQtMwCp50KnMw2boKoduKmMEVuLyfAZNhiI2B.woff2"><link rel="preload" as="font" crossorigin="anonymous" href="https://fonts.gstatic.com/s/inter/v12/UcCO3FwrK3iLTeHuS_fvQtMwCp50KnMw2boKoduKmMEVuLyfAZxhiI2B.woff2"><link rel="preload" as="font" crossorigin="anonymous" href="https://fonts.gstatic.com/s/inter/v12/UcCO3FwrK3iLTeHuS_fvQtMwCp50KnMw2boKoduKmMEVuLyfAZBhiI2B.woff2"><link rel="preload" as="font" crossorigin="anonymous" href="https://fonts.gstatic.com/s/inter/v12/UcCO3FwrK3iLTeHuS_fvQtMwCp50KnMw2boKoduKmMEVuLyfAZFhiI2B.woff2"><link rel="preload" as="font" crossorigin="anonymous" href="https://fonts.gstatic.com/s/inter/v12/UcCO3FwrK3iLTeHuS_fvQtMwCp50KnMw2boKoduKmMEVuLyfAZ9hiA.woff2"><link rel="preload" as="font" crossorigin="anonymous" href="https://fonts.gstatic.com/s/inter/v12/UcCO3FwrK3iLTeHuS_fvQtMwCp50KnMw2boKoduKmMEVuGKYAZJhiI2B.woff2"><link rel="preload" as="font" crossorigin="anonymous" href="https://fonts.gstatic.com/s/inter/v12/UcCO3FwrK3iLTeHuS_fvQtMwCp50KnMw2boKoduKmMEVuGKYAZthiI2B.woff2"><link rel="preload" as="font" crossorigin="anonymous" href="https://fonts.gstatic.com/s/inter/v12/UcCO3FwrK3iLTeHuS_fvQtMwCp50KnMw2boKoduKmMEVuGKYAZNhiI2B.woff2"><link rel="preload" as="font" crossorigin="anonymous" href="https://fonts.gstatic.com/s/inter/v12/UcCO3FwrK3iLTeHuS_fvQtMwCp50KnMw2boKoduKmMEVuGKYAZxhiI2B.woff2"><link rel="preload" as="font" crossorigin="anonymous" href="https://fonts.gstatic.com/s/inter/v12/UcCO3FwrK3iLTeHuS_fvQtMwCp50KnMw2boKoduKmMEVuGKYAZBhiI2B.woff2"><link rel="preload" as="font" crossorigin="anonymous" href="https://fonts.gstatic.com/s/inter/v12/UcCO3FwrK3iLTeHuS_fvQtMwCp50KnMw2boKoduKmMEVuGKYAZFhiI2B.woff2"><link rel="preload" as="font" crossorigin="anonymous" href="https://fonts.gstatic.com/s/inter/v12/UcCO3FwrK3iLTeHuS_fvQtMwCp50KnMw2boKoduKmMEVuGKYAZ9hiA.woff2"><link rel="preload" as="font" crossorigin="anonymous" href="https://fonts.gstatic.com/s/inter/v12/UcCO3FwrK3iLTeHuS_fvQtMwCp50KnMw2boKoduKmMEVuDyYAZJhiI2B.woff2"><link rel="preload" as="font" crossorigin="anonymous" href="https://fonts.gstatic.com/s/inter/v12/UcCO3FwrK3iLTeHuS_fvQtMwCp50KnMw2boKoduKmMEVuDyYAZthiI2B.woff2"><link rel="preload" as="font" crossorigin="anonymous" href="https://fonts.gstatic.com/s/inter/v12/UcCO3FwrK3iLTeHuS_fvQtMwCp50KnMw2boKoduKmMEVuDyYAZNhiI2B.woff2"><link rel="preload" as="font" crossorigin="anonymous" href="https://fonts.gstatic.com/s/inter/v12/UcCO3FwrK3iLTeHuS_fvQtMwCp50KnMw2boKoduKmMEVuDyYAZxhiI2B.woff2"><link rel="preload" as="font" crossorigin="anonymous" href="https://fonts.gstatic.com/s/inter/v12/UcCO3FwrK3iLTeHuS_fvQtMwCp50KnMw2boKoduKmMEVuDyYAZBhiI2B.woff2"><link rel="preload" as="font" crossorigin="anonymous" href="https://fonts.gstatic.com/s/inter/v12/UcCO3FwrK3iLTeHuS_fvQtMwCp50KnMw2boKoduKmMEVuDyYAZFhiI2B.woff2"><link rel="preload" as="font" crossorigin="anonymous" href="https://fonts.gstatic.com/s/inter/v12/UcCO3FwrK3iLTeHuS_fvQtMwCp50KnMw2boKoduKmMEVuDyYAZ9hiA.woff2"></head><body class="font-sans text-gray-700 dark:text-gray-200"><div id="app" data-server-rendered="true"><!--[--><header class="header z-40" data-v-116d6082=""><a href="/" class="w-10 h-10 absolute lg:fixed m-6 select-none outline-none" focusable="false" data-v-116d6082=""><img src="/logo-dark.svg" alt="logo" style="display:none" data-v-116d6082=""><img src="/logo.svg" alt="logo" data-v-116d6082=""></a><nav class="nav" data-v-116d6082=""><div class="spacer" data-v-116d6082=""></div><div class="right" data-v-116d6082=""><a href="/posts" class="" title="Researches" data-v-116d6082=""><span class="lt-md:hidden" data-v-116d6082="">Researches</span><div i-ri-article-line="" md:hidden="" data-v-116d6082=""></div></a><a href="/projects" class="lt-md:hidden" title="Projects" data-v-116d6082="">Projects </a><a href="https://github.com/bizbard" target="_blank" title="GitHub" class="lt-md:hidden" data-v-116d6082=""><div i-uil-github-alt="" data-v-116d6082=""></div></a><a class="select-none" title="Toggle Color Scheme" data-v-116d6082=""><svg style="vertical-align:sub;display:none" class="inline" viewBox="0 0 24 24" width="1.2em" height="1.2em"><path fill="currentColor" d="M10 7a7 7 0 0 0 12 4.9v.1c0 5.523-4.477 10-10 10S2 17.523 2 12S6.477 2 12 2h.1A6.979 6.979 0 0 0 10 7zm-6 5a8 8 0 0 0 15.062 3.762A9 9 0 0 1 8.238 4.938A7.999 7.999 0 0 0 4 12z"></path></svg><svg style="vertical-align:sub" class="inline" viewBox="0 0 24 24" width="1.2em" height="1.2em"><path fill="currentColor" d="M12 18a6 6 0 1 1 0-12a6 6 0 0 1 0 12zm0-2a4 4 0 1 0 0-8a4 4 0 0 0 0 8zM11 1h2v3h-2V1zm0 19h2v3h-2v-3zM3.515 4.929l1.414-1.414L7.05 5.636L5.636 7.05L3.515 4.93zM16.95 18.364l1.414-1.414l2.121 2.121l-1.414 1.414l-2.121-2.121zm2.121-14.85l1.414 1.415l-2.121 2.121l-1.414-1.414l2.121-2.121zM5.636 16.95l1.414 1.414l-2.121 2.121l-1.414-1.414l2.121-2.121zM23 11v2h-3v-2h3zM4 11v2H1v-2h3z"></path></svg></a></div></nav></header><main class="px-7 py-10"><!--[--><!----><div class="prose m-auto mb-8"><h1 class="mb-0">Modern Javascript - 2021</h1><p class="opacity-50 !-mt-2">Oct 1, 2021 <span>· 1month</span></p><!----></div><article><!--[--><div class="prose m-auto"><p></p><div class="table-of-contents"><ul><li><a href="#introduction">Introduction</a></li><li><a href="#callback-in-callback">Callback in callback</a></li><li><a href="#handling-errors">Handling errors</a></li><li><a href="#pyramid-of-doom">Pyramid of Doom</a></li><li><a href="#promise">Promise</a></li><li><a href="#then-catch">then, catch</a><ul><li><a href="#then">then</a></li><li><a href="#catch">catch</a></li></ul></li><li><a href="#finally">finally</a></li><li><a href="#promises-chaining">Promises Chaining</a></li></ul></div><p></p><h2 id="introduction" tabindex="-1">Introduction <a class="header-anchor" href="#introduction" aria-hidden="true">#</a></h2><p>Many functions are provided by JavaScript host environments that allow you to schedule asynchronous actions. In other words, actions that we initiate now, but they finish later. Take a look at the function <strong>loadScript(src)</strong>, that loads a script with the given <strong>src</strong>:</p><pre><code class="language-js"><div class="shiki-container"><pre class="shiki shiki-dark" style="background-color:#121212"><code v-pre=""><span class="line"><span style="color:#cb7676">function</span><span style="color:#dbd7CAEE"> </span><span style="color:#80a665">loadScript</span><span style="color:#666">(</span><span style="color:#bd976a">src</span><span style="color:#666">)</span><span style="color:#dbd7CAEE"> </span><span style="color:#666">{</span></span>
<span class="line"><span style="color:#666">  </span><span style="color:#758575DD">// creates a &lt;script&gt; tag and append it to the page</span></span>
<span class="line"><span style="color:#666">  </span><span style="color:#758575DD">// this causes the script with given src to start loading and run when complete</span></span>
<span class="line"><span style="color:#dbd7CAEE">  </span><span style="color:#cb7676">let</span><span style="color:#dbd7CAEE"> </span><span style="color:#bd976a">script</span><span style="color:#dbd7CAEE"> </span><span style="color:#666">=</span><span style="color:#dbd7CAEE"> </span><span style="color:#bd976a">document</span><span style="color:#666">.</span><span style="color:#80a665">createElement</span><span style="color:#666">(</span><span style="color:#c98A7DAA">'</span><span style="color:#c98a7d">script</span><span style="color:#c98A7DAA">'</span><span style="color:#666">);</span></span>
<span class="line"><span style="color:#dbd7CAEE">  </span><span style="color:#bd976a">script</span><span style="color:#666">.</span><span style="color:#bd976a">src</span><span style="color:#dbd7CAEE"> </span><span style="color:#666">=</span><span style="color:#dbd7CAEE"> </span><span style="color:#bd976a">src</span><span style="color:#666">;</span></span>
<span class="line"><span style="color:#dbd7CAEE">  </span><span style="color:#bd976a">document</span><span style="color:#666">.</span><span style="color:#bd976a">head</span><span style="color:#666">.</span><span style="color:#80a665">append</span><span style="color:#666">(</span><span style="color:#bd976a">script</span><span style="color:#666">);</span></span>
<span class="line"><span style="color:#666">}</span></span>
<span class="line"></span></code></pre><pre class="shiki shiki-light" style="background-color:#fff"><code v-pre=""><span class="line"><span style="color:#ab5959">function</span><span style="color:#393a34"> </span><span style="color:#59873a">loadScript</span><span style="color:#999">(</span><span style="color:#b07d48">src</span><span style="color:#999">)</span><span style="color:#393a34"> </span><span style="color:#999">{</span></span>
<span class="line"><span style="color:#999">  </span><span style="color:#a0ada0">// creates a &lt;script&gt; tag and append it to the page</span></span>
<span class="line"><span style="color:#999">  </span><span style="color:#a0ada0">// this causes the script with given src to start loading and run when complete</span></span>
<span class="line"><span style="color:#393a34">  </span><span style="color:#ab5959">let</span><span style="color:#393a34"> </span><span style="color:#b07d48">script</span><span style="color:#393a34"> </span><span style="color:#999">=</span><span style="color:#393a34"> </span><span style="color:#b07d48">document</span><span style="color:#999">.</span><span style="color:#59873a">createElement</span><span style="color:#999">(</span><span style="color:#b56959AA">'</span><span style="color:#b56959">script</span><span style="color:#b56959AA">'</span><span style="color:#999">);</span></span>
<span class="line"><span style="color:#393a34">  </span><span style="color:#b07d48">script</span><span style="color:#999">.</span><span style="color:#b07d48">src</span><span style="color:#393a34"> </span><span style="color:#999">=</span><span style="color:#393a34"> </span><span style="color:#b07d48">src</span><span style="color:#999">;</span></span>
<span class="line"><span style="color:#393a34">  </span><span style="color:#b07d48">document</span><span style="color:#999">.</span><span style="color:#b07d48">head</span><span style="color:#999">.</span><span style="color:#59873a">append</span><span style="color:#999">(</span><span style="color:#b07d48">script</span><span style="color:#999">);</span></span>
<span class="line"><span style="color:#999">}</span></span>
<span class="line"></span></code></pre></div></code></pre><p>Let’s say we need to use the new script as soon as it loads. It declares new functions, and we want to run them. But if we do that immediately after the <strong>loadScript(…)</strong> call, that wouldn’t work:</p><pre><code class="language-js"><div class="shiki-container"><pre class="shiki shiki-dark" style="background-color:#121212"><code v-pre=""><span class="line"><span style="color:#80a665">loadScript</span><span style="color:#666">(</span><span style="color:#c98A7DAA">'</span><span style="color:#c98a7d">/my/script.js</span><span style="color:#c98A7DAA">'</span><span style="color:#666">);</span><span style="color:#dbd7CAEE"> </span><span style="color:#758575DD">// the script has "function newFunction() {…}"</span></span>
<span class="line"></span>
<span class="line"><span style="color:#80a665">newFunction</span><span style="color:#666">();</span><span style="color:#dbd7CAEE"> </span><span style="color:#758575DD">// no such function!</span></span>
<span class="line"></span></code></pre><pre class="shiki shiki-light" style="background-color:#fff"><code v-pre=""><span class="line"><span style="color:#59873a">loadScript</span><span style="color:#999">(</span><span style="color:#b56959AA">'</span><span style="color:#b56959">/my/script.js</span><span style="color:#b56959AA">'</span><span style="color:#999">);</span><span style="color:#393a34"> </span><span style="color:#a0ada0">// the script has "function newFunction() {…}"</span></span>
<span class="line"></span>
<span class="line"><span style="color:#59873a">newFunction</span><span style="color:#999">();</span><span style="color:#393a34"> </span><span style="color:#a0ada0">// no such function!</span></span>
<span class="line"></span></code></pre></div></code></pre><p>Naturally, the browser probably didn’t have time to load the script. As of now, the <strong>loadScript</strong> function doesn’t provide a way to track the load completion. The script loads and eventually runs, that’s all. But we’d like to know when it happens, to use new functions and variables from that script.</p><p>Let’s add a callback function as a second argument to loadScript that should execute when the script loads:</p><pre><code class="language-js"><div class="shiki-container"><pre class="shiki shiki-dark" style="background-color:#121212"><code v-pre=""><span class="line"><span style="color:#cb7676">function</span><span style="color:#dbd7CAEE"> </span><span style="color:#80a665">loadScript</span><span style="color:#666">(</span><span style="color:#bd976a">src</span><span style="color:#666">,</span><span style="color:#dbd7CAEE"> </span><span style="color:#bd976a">callback</span><span style="color:#666">)</span><span style="color:#dbd7CAEE"> </span><span style="color:#666">{</span></span>
<span class="line"><span style="color:#dbd7CAEE">  </span><span style="color:#cb7676">let</span><span style="color:#dbd7CAEE"> </span><span style="color:#bd976a">script</span><span style="color:#dbd7CAEE"> </span><span style="color:#666">=</span><span style="color:#dbd7CAEE"> </span><span style="color:#bd976a">document</span><span style="color:#666">.</span><span style="color:#80a665">createElement</span><span style="color:#666">(</span><span style="color:#c98A7DAA">'</span><span style="color:#c98a7d">script</span><span style="color:#c98A7DAA">'</span><span style="color:#666">);</span></span>
<span class="line"><span style="color:#dbd7CAEE">  </span><span style="color:#bd976a">script</span><span style="color:#666">.</span><span style="color:#bd976a">src</span><span style="color:#dbd7CAEE"> </span><span style="color:#666">=</span><span style="color:#dbd7CAEE"> </span><span style="color:#bd976a">src</span><span style="color:#666">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#dbd7CAEE">  </span><span style="color:#bd976a">script</span><span style="color:#666">.</span><span style="color:#80a665">onload</span><span style="color:#dbd7CAEE"> </span><span style="color:#666">=</span><span style="color:#dbd7CAEE"> </span><span style="color:#666">()</span><span style="color:#dbd7CAEE"> </span><span style="color:#666">=&gt;</span><span style="color:#dbd7CAEE"> </span><span style="color:#80a665">callback</span><span style="color:#666">(</span><span style="color:#bd976a">script</span><span style="color:#666">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#dbd7CAEE">  </span><span style="color:#bd976a">document</span><span style="color:#666">.</span><span style="color:#bd976a">head</span><span style="color:#666">.</span><span style="color:#80a665">append</span><span style="color:#666">(</span><span style="color:#bd976a">script</span><span style="color:#666">);</span></span>
<span class="line"><span style="color:#666">}</span></span>
<span class="line"></span></code></pre><pre class="shiki shiki-light" style="background-color:#fff"><code v-pre=""><span class="line"><span style="color:#ab5959">function</span><span style="color:#393a34"> </span><span style="color:#59873a">loadScript</span><span style="color:#999">(</span><span style="color:#b07d48">src</span><span style="color:#999">,</span><span style="color:#393a34"> </span><span style="color:#b07d48">callback</span><span style="color:#999">)</span><span style="color:#393a34"> </span><span style="color:#999">{</span></span>
<span class="line"><span style="color:#393a34">  </span><span style="color:#ab5959">let</span><span style="color:#393a34"> </span><span style="color:#b07d48">script</span><span style="color:#393a34"> </span><span style="color:#999">=</span><span style="color:#393a34"> </span><span style="color:#b07d48">document</span><span style="color:#999">.</span><span style="color:#59873a">createElement</span><span style="color:#999">(</span><span style="color:#b56959AA">'</span><span style="color:#b56959">script</span><span style="color:#b56959AA">'</span><span style="color:#999">);</span></span>
<span class="line"><span style="color:#393a34">  </span><span style="color:#b07d48">script</span><span style="color:#999">.</span><span style="color:#b07d48">src</span><span style="color:#393a34"> </span><span style="color:#999">=</span><span style="color:#393a34"> </span><span style="color:#b07d48">src</span><span style="color:#999">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#393a34">  </span><span style="color:#b07d48">script</span><span style="color:#999">.</span><span style="color:#59873a">onload</span><span style="color:#393a34"> </span><span style="color:#999">=</span><span style="color:#393a34"> </span><span style="color:#999">()</span><span style="color:#393a34"> </span><span style="color:#999">=&gt;</span><span style="color:#393a34"> </span><span style="color:#59873a">callback</span><span style="color:#999">(</span><span style="color:#b07d48">script</span><span style="color:#999">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#393a34">  </span><span style="color:#b07d48">document</span><span style="color:#999">.</span><span style="color:#b07d48">head</span><span style="color:#999">.</span><span style="color:#59873a">append</span><span style="color:#999">(</span><span style="color:#b07d48">script</span><span style="color:#999">);</span></span>
<span class="line"><span style="color:#999">}</span></span>
<span class="line"></span></code></pre></div></code></pre><p>That’s the idea: the second argument is a function (usually anonymous) that runs when the action is completed.</p><h2 id="callback-in-callback" tabindex="-1">Callback in callback <a class="header-anchor" href="#callback-in-callback" aria-hidden="true">#</a></h2><p>How can we load two scripts sequentially: the first one, and then the second one after it? The natural solution would be to put the second loadScript call inside the callback, like this:</p><pre><code class="language-js"><div class="shiki-container"><pre class="shiki shiki-dark" style="background-color:#121212"><code v-pre=""><span class="line"><span style="color:#80a665">loadScript</span><span style="color:#666">(</span><span style="color:#c98A7DAA">'</span><span style="color:#c98a7d">/my/script.js</span><span style="color:#c98A7DAA">'</span><span style="color:#666">,</span><span style="color:#dbd7CAEE"> </span><span style="color:#cb7676">function</span><span style="color:#666">(</span><span style="color:#bd976a">script</span><span style="color:#666">)</span><span style="color:#dbd7CAEE"> </span><span style="color:#666">{</span></span>
<span class="line"></span>
<span class="line"><span style="color:#dbd7CAEE">  </span><span style="color:#80a665">alert</span><span style="color:#666">(</span><span style="color:#c98A7DAA">`</span><span style="color:#c98a7d">Cool, the </span><span style="color:#666">${</span><span style="color:#c98a7d">script</span><span style="color:#666">.</span><span style="color:#c98a7d">src</span><span style="color:#666">}</span><span style="color:#c98a7d"> is loaded, let's load one more</span><span style="color:#c98A7DAA">`</span><span style="color:#666">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#dbd7CAEE">  </span><span style="color:#80a665">loadScript</span><span style="color:#666">(</span><span style="color:#c98A7DAA">'</span><span style="color:#c98a7d">/my/script2.js</span><span style="color:#c98A7DAA">'</span><span style="color:#666">,</span><span style="color:#dbd7CAEE"> </span><span style="color:#cb7676">function</span><span style="color:#666">(</span><span style="color:#bd976a">script</span><span style="color:#666">)</span><span style="color:#dbd7CAEE"> </span><span style="color:#666">{</span></span>
<span class="line"><span style="color:#dbd7CAEE">    </span><span style="color:#80a665">alert</span><span style="color:#666">(</span><span style="color:#c98A7DAA">`</span><span style="color:#c98a7d">Cool, the second script is loaded</span><span style="color:#c98A7DAA">`</span><span style="color:#666">);</span></span>
<span class="line"><span style="color:#dbd7CAEE">  </span><span style="color:#666">});</span></span>
<span class="line"></span>
<span class="line"><span style="color:#666">});</span></span>
<span class="line"></span></code></pre><pre class="shiki shiki-light" style="background-color:#fff"><code v-pre=""><span class="line"><span style="color:#59873a">loadScript</span><span style="color:#999">(</span><span style="color:#b56959AA">'</span><span style="color:#b56959">/my/script.js</span><span style="color:#b56959AA">'</span><span style="color:#999">,</span><span style="color:#393a34"> </span><span style="color:#ab5959">function</span><span style="color:#999">(</span><span style="color:#b07d48">script</span><span style="color:#999">)</span><span style="color:#393a34"> </span><span style="color:#999">{</span></span>
<span class="line"></span>
<span class="line"><span style="color:#393a34">  </span><span style="color:#59873a">alert</span><span style="color:#999">(</span><span style="color:#b56959AA">`</span><span style="color:#b56959">Cool, the </span><span style="color:#999">${</span><span style="color:#b56959">script</span><span style="color:#999">.</span><span style="color:#b56959">src</span><span style="color:#999">}</span><span style="color:#b56959"> is loaded, let's load one more</span><span style="color:#b56959AA">`</span><span style="color:#999">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#393a34">  </span><span style="color:#59873a">loadScript</span><span style="color:#999">(</span><span style="color:#b56959AA">'</span><span style="color:#b56959">/my/script2.js</span><span style="color:#b56959AA">'</span><span style="color:#999">,</span><span style="color:#393a34"> </span><span style="color:#ab5959">function</span><span style="color:#999">(</span><span style="color:#b07d48">script</span><span style="color:#999">)</span><span style="color:#393a34"> </span><span style="color:#999">{</span></span>
<span class="line"><span style="color:#393a34">    </span><span style="color:#59873a">alert</span><span style="color:#999">(</span><span style="color:#b56959AA">`</span><span style="color:#b56959">Cool, the second script is loaded</span><span style="color:#b56959AA">`</span><span style="color:#999">);</span></span>
<span class="line"><span style="color:#393a34">  </span><span style="color:#999">});</span></span>
<span class="line"></span>
<span class="line"><span style="color:#999">});</span></span>
<span class="line"></span></code></pre></div></code></pre><p>What if we want one more script…? So, every new action is inside a callback. That’s fine for few actions, but not good for many, so we’ll see other variants soon.</p><h2 id="handling-errors" tabindex="-1">Handling errors <a class="header-anchor" href="#handling-errors" aria-hidden="true">#</a></h2><p>In the above examples we didn’t consider errors. What if the script loading fails? Our callback should be able to react on that.</p><pre><code class="language-js"><div class="shiki-container"><pre class="shiki shiki-dark" style="background-color:#121212"><code v-pre=""><span class="line"><span style="color:#80a665">loadScript</span><span style="color:#666">(</span><span style="color:#c98A7DAA">'</span><span style="color:#c98a7d">/my/script.js</span><span style="color:#c98A7DAA">'</span><span style="color:#666">,</span><span style="color:#dbd7CAEE"> </span><span style="color:#cb7676">function</span><span style="color:#666">(</span><span style="color:#bd976a">error</span><span style="color:#666">,</span><span style="color:#dbd7CAEE"> </span><span style="color:#bd976a">script</span><span style="color:#666">)</span><span style="color:#dbd7CAEE"> </span><span style="color:#666">{</span></span>
<span class="line"><span style="color:#dbd7CAEE">  </span><span style="color:#4d9375">if</span><span style="color:#dbd7CAEE"> </span><span style="color:#666">(</span><span style="color:#bd976a">error</span><span style="color:#666">)</span><span style="color:#dbd7CAEE"> </span><span style="color:#666">{</span></span>
<span class="line"><span style="color:#666">    </span><span style="color:#758575DD">// handle error</span></span>
<span class="line"><span style="color:#dbd7CAEE">  </span><span style="color:#666">}</span><span style="color:#dbd7CAEE"> </span><span style="color:#4d9375">else</span><span style="color:#dbd7CAEE"> </span><span style="color:#666">{</span></span>
<span class="line"><span style="color:#666">    </span><span style="color:#758575DD">// script loaded successfully</span></span>
<span class="line"><span style="color:#dbd7CAEE">  </span><span style="color:#666">}</span></span>
<span class="line"><span style="color:#666">});</span></span>
<span class="line"></span></code></pre><pre class="shiki shiki-light" style="background-color:#fff"><code v-pre=""><span class="line"><span style="color:#59873a">loadScript</span><span style="color:#999">(</span><span style="color:#b56959AA">'</span><span style="color:#b56959">/my/script.js</span><span style="color:#b56959AA">'</span><span style="color:#999">,</span><span style="color:#393a34"> </span><span style="color:#ab5959">function</span><span style="color:#999">(</span><span style="color:#b07d48">error</span><span style="color:#999">,</span><span style="color:#393a34"> </span><span style="color:#b07d48">script</span><span style="color:#999">)</span><span style="color:#393a34"> </span><span style="color:#999">{</span></span>
<span class="line"><span style="color:#393a34">  </span><span style="color:#1e754f">if</span><span style="color:#393a34"> </span><span style="color:#999">(</span><span style="color:#b07d48">error</span><span style="color:#999">)</span><span style="color:#393a34"> </span><span style="color:#999">{</span></span>
<span class="line"><span style="color:#999">    </span><span style="color:#a0ada0">// handle error</span></span>
<span class="line"><span style="color:#393a34">  </span><span style="color:#999">}</span><span style="color:#393a34"> </span><span style="color:#1e754f">else</span><span style="color:#393a34"> </span><span style="color:#999">{</span></span>
<span class="line"><span style="color:#999">    </span><span style="color:#a0ada0">// script loaded successfully</span></span>
<span class="line"><span style="color:#393a34">  </span><span style="color:#999">}</span></span>
<span class="line"><span style="color:#999">});</span></span>
<span class="line"></span></code></pre></div></code></pre><p>The convention is:</p><ul><li>The first argument of the callback is reserved for an error if it occurs. Then callback(err) is called.</li><li>The second argument (and the next ones if needed) are for the successful result. Then callback(null, result1, result2…) is called.</li></ul><p>So the single callback function is used both for reporting errors and passing back results.</p><h2 id="pyramid-of-doom" tabindex="-1">Pyramid of Doom <a class="header-anchor" href="#pyramid-of-doom" aria-hidden="true">#</a></h2><p>At first glance, it looks like a viable approach to asynchronous coding. And indeed it is. For one or maybe two nested calls it looks fine.</p><p>But for multiple asynchronous actions that follow one after another, we’ll have code like this:</p><figure><img src="/images/pyramid-of-doom.png" alt="Pyramid of Doom"><figcaption>Pyramid of Doom</figcaption></figure><p>In the code above:</p><ul><li>We load <strong>1.js</strong>, then if there’s no error…</li><li>We load <strong>2.js</strong>, then if there’s no error…</li><li>We load <strong>3.js</strong>, then if there’s no error – do something else <strong>(*)</strong>.</li></ul><p>As calls become more nested, the code becomes deeper and increasingly more difficult to manage, especially if we have real code instead of <em>…</em> that may include more loops, conditional statements and so on.</p><p>That’s sometimes called “callback hell” or “pyramid of doom.”</p><h2 id="promise" tabindex="-1">Promise <a class="header-anchor" href="#promise" aria-hidden="true">#</a></h2><p>Imagine a real-life analogy for things we often have in programming:</p><ul><li>A “producing code” that does something and takes time. For instance, some code that loads the data over a network.</li><li>A “consuming code” that wants the result of the “producing code” once it’s ready. Many functions may need that result.</li><li>A promise is a special JavaScript object that links the “producing code” and the “consuming code” together. In terms of our analogy: this is the “subscription list”. The “producing code” takes whatever time it needs to produce the promised result, and the “promise” makes that result available to all of the subscribed code when it’s ready.</li></ul><p>The constructor syntax for a promise object is:</p><pre><code class="language-js"><div class="shiki-container"><pre class="shiki shiki-dark" style="background-color:#121212"><code v-pre=""><span class="line"><span style="color:#cb7676">let</span><span style="color:#dbd7CAEE"> </span><span style="color:#bd976a">promise</span><span style="color:#dbd7CAEE"> </span><span style="color:#666">=</span><span style="color:#dbd7CAEE"> </span><span style="color:#cb7676">new</span><span style="color:#dbd7CAEE"> </span><span style="color:#b8a965">Promise</span><span style="color:#666">(</span><span style="color:#cb7676">function</span><span style="color:#666">(</span><span style="color:#bd976a">resolve</span><span style="color:#666">,</span><span style="color:#dbd7CAEE"> </span><span style="color:#bd976a">reject</span><span style="color:#666">)</span><span style="color:#dbd7CAEE"> </span><span style="color:#666">{</span></span>
<span class="line"><span style="color:#666">  </span><span style="color:#758575DD">// executor (the producing code, "singer")</span></span>
<span class="line"><span style="color:#666">});</span></span>
<span class="line"></span></code></pre><pre class="shiki shiki-light" style="background-color:#fff"><code v-pre=""><span class="line"><span style="color:#ab5959">let</span><span style="color:#393a34"> </span><span style="color:#b07d48">promise</span><span style="color:#393a34"> </span><span style="color:#999">=</span><span style="color:#393a34"> </span><span style="color:#ab5959">new</span><span style="color:#393a34"> </span><span style="color:#998418">Promise</span><span style="color:#999">(</span><span style="color:#ab5959">function</span><span style="color:#999">(</span><span style="color:#b07d48">resolve</span><span style="color:#999">,</span><span style="color:#393a34"> </span><span style="color:#b07d48">reject</span><span style="color:#999">)</span><span style="color:#393a34"> </span><span style="color:#999">{</span></span>
<span class="line"><span style="color:#999">  </span><span style="color:#a0ada0">// executor (the producing code, "singer")</span></span>
<span class="line"><span style="color:#999">});</span></span>
<span class="line"></span></code></pre></div></code></pre><p>The function passed to <strong>new Promise</strong> is called the executor. When <strong>new Promise</strong> is created, the executor runs automatically. It contains the producing code which should eventually produce the result.</p><p>Its arguments <strong>resolve</strong> and <strong>reject</strong> are callbacks provided by JavaScript itself. Our code is only inside the executor. When the executor obtains the result, be it soon or late, doesn’t matter, it should call one of these callbacks:</p><ul><li><strong>resolve(value)</strong> — if the job is finished successfully, with result value.</li><li><strong>reject(error)</strong> — if an error has occurred, error is the error object.</li></ul><p>So to summarize: the executor runs automatically and attempts to perform a job. When it is finished with the attempt, it calls <strong>resolve</strong> if it was successful or <strong>reject</strong> if there was an error.</p><p>The <strong>promise</strong> object returned by the <strong>new Promise</strong> constructor has these internal properties:</p><ul><li>state — initially <code>pending</code>, then changes to either <code>fulfilled</code> when resolve is called or <code>rejected</code> when reject is called.</li><li>result — initially <code>undefined</code>, then changes to <code>value</code> when resolve(value) is called or <code>error</code> when reject(error) is called.</li></ul><p>So the executor eventually moves promise to one of these states:</p><figure><img src="/images/promise-state.png" alt="Promise State"><figcaption>State of Promise</figcaption></figure><p>To summarize, the executor should perform a job (usually something that takes time) and then call resolve or reject to change the state of the corresponding promise object.</p><h2 id="then-catch" tabindex="-1">then, catch <a class="header-anchor" href="#then-catch" aria-hidden="true">#</a></h2><p>Consuming functions can be registered (subscribed) using the methods <strong>.then</strong> and <strong>.catch</strong>.</p><h3 id="then" tabindex="-1">then <a class="header-anchor" href="#then" aria-hidden="true">#</a></h3><p>The most important, fundamental one is <strong>.then</strong>. The syntax is:</p><pre><code class="language-js"><div class="shiki-container"><pre class="shiki shiki-dark" style="background-color:#121212"><code v-pre=""><span class="line"><span style="color:#bd976a">promise</span><span style="color:#666">.</span><span style="color:#80a665">then</span><span style="color:#666">(</span></span>
<span class="line"><span style="color:#dbd7CAEE">  </span><span style="color:#cb7676">function</span><span style="color:#666">(</span><span style="color:#bd976a">result</span><span style="color:#666">)</span><span style="color:#dbd7CAEE"> </span><span style="color:#666">{</span><span style="color:#dbd7CAEE"> </span><span style="color:#758575DD">/* handle a successful result */</span><span style="color:#dbd7CAEE"> </span><span style="color:#666">},</span></span>
<span class="line"><span style="color:#dbd7CAEE">  </span><span style="color:#cb7676">function</span><span style="color:#666">(</span><span style="color:#bd976a">error</span><span style="color:#666">)</span><span style="color:#dbd7CAEE"> </span><span style="color:#666">{</span><span style="color:#dbd7CAEE"> </span><span style="color:#758575DD">/* handle an error */</span><span style="color:#dbd7CAEE"> </span><span style="color:#666">}</span></span>
<span class="line"><span style="color:#666">);</span></span>
<span class="line"></span></code></pre><pre class="shiki shiki-light" style="background-color:#fff"><code v-pre=""><span class="line"><span style="color:#b07d48">promise</span><span style="color:#999">.</span><span style="color:#59873a">then</span><span style="color:#999">(</span></span>
<span class="line"><span style="color:#393a34">  </span><span style="color:#ab5959">function</span><span style="color:#999">(</span><span style="color:#b07d48">result</span><span style="color:#999">)</span><span style="color:#393a34"> </span><span style="color:#999">{</span><span style="color:#393a34"> </span><span style="color:#a0ada0">/* handle a successful result */</span><span style="color:#393a34"> </span><span style="color:#999">},</span></span>
<span class="line"><span style="color:#393a34">  </span><span style="color:#ab5959">function</span><span style="color:#999">(</span><span style="color:#b07d48">error</span><span style="color:#999">)</span><span style="color:#393a34"> </span><span style="color:#999">{</span><span style="color:#393a34"> </span><span style="color:#a0ada0">/* handle an error */</span><span style="color:#393a34"> </span><span style="color:#999">}</span></span>
<span class="line"><span style="color:#999">);</span></span>
<span class="line"></span></code></pre></div></code></pre><p>The first argument of .then is a function that runs when the promise is resolved and receives the result. The second argument of .then is a function that runs when the promise is rejected and receives the error.</p><h3 id="catch" tabindex="-1">catch <a class="header-anchor" href="#catch" aria-hidden="true">#</a></h3><p>If we’re interested only in errors, then we can use null as the first argument: <strong>.then(null, errorHandlingFunction)</strong>. Or we can use <strong>.catch(errorHandlingFunction)</strong>, which is exactly the same:</p><pre><code class="language-js"><div class="shiki-container"><pre class="shiki shiki-dark" style="background-color:#121212"><code v-pre=""><span class="line"><span style="color:#cb7676">let</span><span style="color:#dbd7CAEE"> </span><span style="color:#bd976a">promise</span><span style="color:#dbd7CAEE"> </span><span style="color:#666">=</span><span style="color:#dbd7CAEE"> </span><span style="color:#cb7676">new</span><span style="color:#dbd7CAEE"> </span><span style="color:#b8a965">Promise</span><span style="color:#666">((</span><span style="color:#bd976a">resolve</span><span style="color:#666">,</span><span style="color:#dbd7CAEE"> </span><span style="color:#bd976a">reject</span><span style="color:#666">)</span><span style="color:#dbd7CAEE"> </span><span style="color:#666">=&gt;</span><span style="color:#dbd7CAEE"> </span><span style="color:#666">{</span></span>
<span class="line"><span style="color:#dbd7CAEE">  </span><span style="color:#80a665">setTimeout</span><span style="color:#666">(()</span><span style="color:#dbd7CAEE"> </span><span style="color:#666">=&gt;</span><span style="color:#dbd7CAEE"> </span><span style="color:#80a665">reject</span><span style="color:#666">(</span><span style="color:#cb7676">new</span><span style="color:#dbd7CAEE"> </span><span style="color:#80a665">Error</span><span style="color:#666">(</span><span style="color:#c98A7DAA">"</span><span style="color:#c98a7d">Whoops!</span><span style="color:#c98A7DAA">"</span><span style="color:#666">)),</span><span style="color:#dbd7CAEE"> </span><span style="color:#4c9a91">1000</span><span style="color:#666">);</span></span>
<span class="line"><span style="color:#666">});</span></span>
<span class="line"></span>
<span class="line"><span style="color:#758575DD">// .catch(f) is the same as promise.then(null, f)</span></span>
<span class="line"><span style="color:#bd976a">promise</span><span style="color:#666">.</span><span style="color:#80a665">catch</span><span style="color:#666">(</span><span style="color:#bd976a">alert</span><span style="color:#666">);</span><span style="color:#dbd7CAEE"> </span><span style="color:#758575DD">// shows "Error: Whoops!" after 1 second</span></span>
<span class="line"></span></code></pre><pre class="shiki shiki-light" style="background-color:#fff"><code v-pre=""><span class="line"><span style="color:#ab5959">let</span><span style="color:#393a34"> </span><span style="color:#b07d48">promise</span><span style="color:#393a34"> </span><span style="color:#999">=</span><span style="color:#393a34"> </span><span style="color:#ab5959">new</span><span style="color:#393a34"> </span><span style="color:#998418">Promise</span><span style="color:#999">((</span><span style="color:#b07d48">resolve</span><span style="color:#999">,</span><span style="color:#393a34"> </span><span style="color:#b07d48">reject</span><span style="color:#999">)</span><span style="color:#393a34"> </span><span style="color:#999">=&gt;</span><span style="color:#393a34"> </span><span style="color:#999">{</span></span>
<span class="line"><span style="color:#393a34">  </span><span style="color:#59873a">setTimeout</span><span style="color:#999">(()</span><span style="color:#393a34"> </span><span style="color:#999">=&gt;</span><span style="color:#393a34"> </span><span style="color:#59873a">reject</span><span style="color:#999">(</span><span style="color:#ab5959">new</span><span style="color:#393a34"> </span><span style="color:#59873a">Error</span><span style="color:#999">(</span><span style="color:#b56959AA">"</span><span style="color:#b56959">Whoops!</span><span style="color:#b56959AA">"</span><span style="color:#999">)),</span><span style="color:#393a34"> </span><span style="color:#2f798a">1000</span><span style="color:#999">);</span></span>
<span class="line"><span style="color:#999">});</span></span>
<span class="line"></span>
<span class="line"><span style="color:#a0ada0">// .catch(f) is the same as promise.then(null, f)</span></span>
<span class="line"><span style="color:#b07d48">promise</span><span style="color:#999">.</span><span style="color:#59873a">catch</span><span style="color:#999">(</span><span style="color:#b07d48">alert</span><span style="color:#999">);</span><span style="color:#393a34"> </span><span style="color:#a0ada0">// shows "Error: Whoops!" after 1 second</span></span>
<span class="line"></span></code></pre></div></code></pre><p>The call <strong>.catch(f)</strong> is a complete analog of <strong>.then(null, f)</strong>, it’s just a shorthand.</p><h2 id="finally" tabindex="-1">finally <a class="header-anchor" href="#finally" aria-hidden="true">#</a></h2><p>Just like there’s a finally clause in a regular try {…} catch {…}, there’s finally in promises. The idea of finally is to set up a handler for performing cleanup/finalizing after the previous operations are complete.</p><ul><li>A <strong>finally</strong> handler has no arguments. In finally we don’t know whether the promise is successful or not. That’s all right, as our task is usually to perform “general” finalizing procedures.</li><li>A <strong>finally</strong> handler “passes through” the result or error to the next suitable handler.</li><li>A <strong>finally</strong> handler also shouldn’t return anything. If it does, the returned value is silently ignored.</li></ul><h2 id="promises-chaining" tabindex="-1">Promises Chaining <a class="header-anchor" href="#promises-chaining" aria-hidden="true">#</a></h2><p>Now we have a sequence of asynchronous tasks to be performed one after another — for instance, loading scripts. How can we code it well? Promises provide a couple of recipes to do that. It looks like this:</p><pre><code class="language-js"><div class="shiki-container"><pre class="shiki shiki-dark" style="background-color:#121212"><code v-pre=""><span class="line"><span style="color:#cb7676">new</span><span style="color:#dbd7CAEE"> </span><span style="color:#b8a965">Promise</span><span style="color:#666">(</span><span style="color:#cb7676">function</span><span style="color:#666">(</span><span style="color:#bd976a">resolve</span><span style="color:#666">,</span><span style="color:#dbd7CAEE"> </span><span style="color:#bd976a">reject</span><span style="color:#666">)</span><span style="color:#dbd7CAEE"> </span><span style="color:#666">{</span></span>
<span class="line"></span>
<span class="line"><span style="color:#dbd7CAEE">  </span><span style="color:#80a665">setTimeout</span><span style="color:#666">(()</span><span style="color:#dbd7CAEE"> </span><span style="color:#666">=&gt;</span><span style="color:#dbd7CAEE"> </span><span style="color:#80a665">resolve</span><span style="color:#666">(</span><span style="color:#4c9a91">1</span><span style="color:#666">),</span><span style="color:#dbd7CAEE"> </span><span style="color:#4c9a91">1000</span><span style="color:#666">);</span><span style="color:#dbd7CAEE"> </span><span style="color:#758575DD">// (*)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#666">}).</span><span style="color:#80a665">then</span><span style="color:#666">(</span><span style="color:#cb7676">function</span><span style="color:#666">(</span><span style="color:#bd976a">result</span><span style="color:#666">)</span><span style="color:#dbd7CAEE"> </span><span style="color:#666">{</span><span style="color:#dbd7CAEE"> </span><span style="color:#758575DD">// (**)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#dbd7CAEE">  </span><span style="color:#80a665">alert</span><span style="color:#666">(</span><span style="color:#bd976a">result</span><span style="color:#666">);</span><span style="color:#dbd7CAEE"> </span><span style="color:#758575DD">// 1</span></span>
<span class="line"><span style="color:#dbd7CAEE">  </span><span style="color:#4d9375">return</span><span style="color:#dbd7CAEE"> </span><span style="color:#bd976a">result</span><span style="color:#dbd7CAEE"> </span><span style="color:#cb7676">*</span><span style="color:#dbd7CAEE"> </span><span style="color:#4c9a91">2</span><span style="color:#666">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#666">}).</span><span style="color:#80a665">then</span><span style="color:#666">(</span><span style="color:#cb7676">function</span><span style="color:#666">(</span><span style="color:#bd976a">result</span><span style="color:#666">)</span><span style="color:#dbd7CAEE"> </span><span style="color:#666">{</span><span style="color:#dbd7CAEE"> </span><span style="color:#758575DD">// (***)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#dbd7CAEE">  </span><span style="color:#80a665">alert</span><span style="color:#666">(</span><span style="color:#bd976a">result</span><span style="color:#666">);</span><span style="color:#dbd7CAEE"> </span><span style="color:#758575DD">// 2</span></span>
<span class="line"><span style="color:#dbd7CAEE">  </span><span style="color:#4d9375">return</span><span style="color:#dbd7CAEE"> </span><span style="color:#bd976a">result</span><span style="color:#dbd7CAEE"> </span><span style="color:#cb7676">*</span><span style="color:#dbd7CAEE"> </span><span style="color:#4c9a91">2</span><span style="color:#666">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#666">}).</span><span style="color:#80a665">then</span><span style="color:#666">(</span><span style="color:#cb7676">function</span><span style="color:#666">(</span><span style="color:#bd976a">result</span><span style="color:#666">)</span><span style="color:#dbd7CAEE"> </span><span style="color:#666">{</span></span>
<span class="line"></span>
<span class="line"><span style="color:#dbd7CAEE">  </span><span style="color:#80a665">alert</span><span style="color:#666">(</span><span style="color:#bd976a">result</span><span style="color:#666">);</span><span style="color:#dbd7CAEE"> </span><span style="color:#758575DD">// 4</span></span>
<span class="line"><span style="color:#dbd7CAEE">  </span><span style="color:#4d9375">return</span><span style="color:#dbd7CAEE"> </span><span style="color:#bd976a">result</span><span style="color:#dbd7CAEE"> </span><span style="color:#cb7676">*</span><span style="color:#dbd7CAEE"> </span><span style="color:#4c9a91">2</span><span style="color:#666">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#666">});</span></span>
<span class="line"></span></code></pre><pre class="shiki shiki-light" style="background-color:#fff"><code v-pre=""><span class="line"><span style="color:#ab5959">new</span><span style="color:#393a34"> </span><span style="color:#998418">Promise</span><span style="color:#999">(</span><span style="color:#ab5959">function</span><span style="color:#999">(</span><span style="color:#b07d48">resolve</span><span style="color:#999">,</span><span style="color:#393a34"> </span><span style="color:#b07d48">reject</span><span style="color:#999">)</span><span style="color:#393a34"> </span><span style="color:#999">{</span></span>
<span class="line"></span>
<span class="line"><span style="color:#393a34">  </span><span style="color:#59873a">setTimeout</span><span style="color:#999">(()</span><span style="color:#393a34"> </span><span style="color:#999">=&gt;</span><span style="color:#393a34"> </span><span style="color:#59873a">resolve</span><span style="color:#999">(</span><span style="color:#2f798a">1</span><span style="color:#999">),</span><span style="color:#393a34"> </span><span style="color:#2f798a">1000</span><span style="color:#999">);</span><span style="color:#393a34"> </span><span style="color:#a0ada0">// (*)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#999">}).</span><span style="color:#59873a">then</span><span style="color:#999">(</span><span style="color:#ab5959">function</span><span style="color:#999">(</span><span style="color:#b07d48">result</span><span style="color:#999">)</span><span style="color:#393a34"> </span><span style="color:#999">{</span><span style="color:#393a34"> </span><span style="color:#a0ada0">// (**)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#393a34">  </span><span style="color:#59873a">alert</span><span style="color:#999">(</span><span style="color:#b07d48">result</span><span style="color:#999">);</span><span style="color:#393a34"> </span><span style="color:#a0ada0">// 1</span></span>
<span class="line"><span style="color:#393a34">  </span><span style="color:#1e754f">return</span><span style="color:#393a34"> </span><span style="color:#b07d48">result</span><span style="color:#393a34"> </span><span style="color:#ab5959">*</span><span style="color:#393a34"> </span><span style="color:#2f798a">2</span><span style="color:#999">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#999">}).</span><span style="color:#59873a">then</span><span style="color:#999">(</span><span style="color:#ab5959">function</span><span style="color:#999">(</span><span style="color:#b07d48">result</span><span style="color:#999">)</span><span style="color:#393a34"> </span><span style="color:#999">{</span><span style="color:#393a34"> </span><span style="color:#a0ada0">// (***)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#393a34">  </span><span style="color:#59873a">alert</span><span style="color:#999">(</span><span style="color:#b07d48">result</span><span style="color:#999">);</span><span style="color:#393a34"> </span><span style="color:#a0ada0">// 2</span></span>
<span class="line"><span style="color:#393a34">  </span><span style="color:#1e754f">return</span><span style="color:#393a34"> </span><span style="color:#b07d48">result</span><span style="color:#393a34"> </span><span style="color:#ab5959">*</span><span style="color:#393a34"> </span><span style="color:#2f798a">2</span><span style="color:#999">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#999">}).</span><span style="color:#59873a">then</span><span style="color:#999">(</span><span style="color:#ab5959">function</span><span style="color:#999">(</span><span style="color:#b07d48">result</span><span style="color:#999">)</span><span style="color:#393a34"> </span><span style="color:#999">{</span></span>
<span class="line"></span>
<span class="line"><span style="color:#393a34">  </span><span style="color:#59873a">alert</span><span style="color:#999">(</span><span style="color:#b07d48">result</span><span style="color:#999">);</span><span style="color:#393a34"> </span><span style="color:#a0ada0">// 4</span></span>
<span class="line"><span style="color:#393a34">  </span><span style="color:#1e754f">return</span><span style="color:#393a34"> </span><span style="color:#b07d48">result</span><span style="color:#393a34"> </span><span style="color:#ab5959">*</span><span style="color:#393a34"> </span><span style="color:#2f798a">2</span><span style="color:#999">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#999">});</span></span>
<span class="line"></span></code></pre></div></code></pre><p>The idea is that the result is passed through the chain of <strong>.then</strong> handlers. Here the flow is:</p><ul><li>The initial promise resolves in 1 second (*),</li><li>Then the .then handler is called (**), which in turn creates a new promise (resolved with 2 value).</li><li>The next then (***) gets the result of the previous one, processes it (doubles) and passes it to the next handler.</li><li>…and so on.</li></ul><p>As the result is passed along the chain of handlers, we can see a sequence of alert calls:</p><figure><img src="/images/promise-chaining.png" alt="Promise Chaining"><figcaption>Chaining of Promise</figcaption></figure><p>The whole thing works, because every call to a .then returns a new promise, so that we can call the next .then on it. When a handler returns a value, it becomes the result of that promise, so the next .then is called with it.</p></div><!--]--></article><div class="prose m-auto mt-8 mb-8"><span font-mono="" op50="">&gt; </span><a href="/posts" class="font-mono op50 hover:op75"></a></div><!--]--><div class="mt-10 mb-6 prose m-auto opacity-50 flex"><span class="text-sm"><a target="_blank" href="https://creativecommons.org/licenses/by-nc-sa/4.0/" style="color:inherit">CC BY-NC-SA 4.0</a> 2022-PRESENT © Jeff</span><div class="flex-auto"></div></div></main><!--]--></div><script async="" src="https://platform.twitter.com/widgets.js" charset="utf-8"></script><link rel="stylesheet" href="/assets/index-85ed439e.css"></body></html>